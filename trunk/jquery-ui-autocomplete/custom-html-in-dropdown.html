<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<link type="text/css" href="../demoengine/demoengine.css" rel="stylesheet">
	<script type="text/javascript" src="../demoengine/demoengine.js" async defer></script>
	<title>jQuery UI Autocomplete: Custom HTML in Dropdown</title>
	<link type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/themes/ui-darkness/jquery-ui.css" rel="stylesheet">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<style type="text/css">
		.loading {
			display: none;
			width: 16px;
			height: 16px;
			background-image: url(loading.gif);
			vertical-align: text-bottom;
		}
		/* autocomplete adds the ui-autocomplete-loading class to the textbox when it is _busy_ */
		/* ingeniously using general sibling combinator */
		#autocomplete.ui-autocomplete-loading ~ .loading {
			display: inline-block;
		}
		.ui-autocomplete .fl {
			float: left;
			margin-right: 8px;
		}
		.ui-autocomplete .fr {
			float: right;
			margin-left: 8px;
		}
		.ui-autocomplete .db {
			display: block;
		}
		/* star rating explained here: http://salman-w.blogspot.com/2012/08/star-ratings-using-css-sprites.html */
		.ui-autocomplete .rg {
			display: block;
			width: 130px;
			height: 13px;
			background: url(stars.png) 0 0;
		}
		.ui-autocomplete .rg span {
			display: block;
			height: 13px;
			background: url(stars.png) 0 -13px;
		}
	</style>
</head>
<body>
	<form action="http://www.imdb.com/find" target="_blank">
		<input id="autocomplete" type="text" placeholder="Movie name" name="q">
		<span class="loading"></span>
		<input type="hidden" name="s" value="tt">
	</form>
	<script type="text/javascript">
		/*
		 * jQuery UI Autocomplete: Custom HTML in Dropdown
		 * http://salman-w.blogspot.com/2013/12/jquery-ui-autocomplete-examples.html
		 */
		$(function() {
			$("#autocomplete").autocomplete({
				delay: 500,
				minLength: 3,
				source: function(request, response) {
					$.getJSON("http://mymovieapi.com/", {
						q: request.term,
						mt: "M",
						plot: "none",
						limit: 10
					}, function(data) {
						// data is an array of objects and must be transformed for autocomplete to use
						var array = data.error ? [] : $.map(data, function(o) {
							return {
								label: o.title,
								year: o.year,
								cast: o.actors ? o.actors.slice(0, 3).join(", ") : "-",
								rating: o.rating,
								url: o.imdb_url
							};
						});
						response(array);
					});
				},
				focus: function(event, ui) {
					// prevent autocomplete from updating the textbox
					event.preventDefault();
				},
				select: function(event, ui) {
					// prevent autocomplete from updating the textbox
					event.preventDefault();
					// navigate to the selected item's url
					window.open(ui.item.url);
				}
			}).data("ui-autocomplete")._renderItem = function(ul, item) {
				var $a = $("<a></a>").text(item.label);
				$("<span class='fr'></span>").text(item.year).prependTo($a);
				$("<small class='db'></small>").text(item.cast).appendTo($a);
				$("<span class='fl rg'><span style='width: " + Math.floor(item.rating * 10) + "%;'></span></span>").appendTo($a);
				$("<small class='db'></small>").text(item.rating + "/10").appendTo($a);
				return $("<li></li>").append($a).appendTo(ul);
			};
		});
	</script>
	<p>Data by <a href="http://mymovieapi.com/" target="_blank">My Movie API</a>; a easy way to access the <a href="http://www.imdb.com/" target="_blank">IMDB</a> data.</p>
</body>
</html>
